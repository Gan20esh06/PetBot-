<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Test - Object Detection</title>

    <!-- TensorFlow.js and COCO-SSD -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #1a1a2e;
        color: white;
      }
      button {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
      }
      button:hover {
        background: #2563eb;
      }
      #status {
        margin: 20px 0;
        padding: 15px;
        background: rgba(59, 130, 246, 0.2);
        border-radius: 8px;
      }
      video {
        width: 100%;
        max-width: 640px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .log {
        background: #0f0f23;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Quick Test - AI Object Detection</h1>

    <button onclick="testTensorFlow()">1Ô∏è‚É£ Test TensorFlow.js Loading</button>
    <button onclick="testCamera()">2Ô∏è‚É£ Test Camera Access</button>
    <button onclick="testDetection()">3Ô∏è‚É£ Test Object Detection</button>

    <div id="status">Click buttons above to test each feature...</div>

    <video id="video" autoplay playsinline style="display: none"></video>

    <div class="log" id="log"></div>

    <script>
      const status = document.getElementById("status");
      const logDiv = document.getElementById("log");
      const video = document.getElementById("video");
      let model = null;
      let stream = null;

      function log(message) {
        console.log(message);
        logDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      async function testTensorFlow() {
        try {
          status.textContent = "‚è≥ Loading TensorFlow.js...";
          log("üì¶ Starting TensorFlow.js test...");

          if (typeof tf === "undefined") {
            throw new Error("TensorFlow.js not loaded!");
          }

          log("‚úÖ TensorFlow.js library loaded");
          log(`üìä TensorFlow.js version: ${tf.version.tfjs}`);

          status.textContent = "‚è≥ Loading COCO-SSD model...";
          log("üì¶ Loading COCO-SSD model...");

          if (typeof cocoSsd === "undefined") {
            throw new Error("COCO-SSD library not loaded!");
          }

          model = await cocoSsd.load();

          log("‚úÖ COCO-SSD model loaded successfully!");
          log(`üéØ Model ready to detect 80 object classes`);

          status.textContent =
            "‚úÖ TensorFlow.js and COCO-SSD loaded successfully!";
          status.style.background = "rgba(34, 197, 94, 0.2)";
        } catch (error) {
          log("‚ùå Error: " + error.message);
          status.textContent = "‚ùå Error: " + error.message;
          status.style.background = "rgba(239, 68, 68, 0.2)";
        }
      }

      async function testCamera() {
        try {
          status.textContent = "üì∑ Requesting camera access...";
          log("üì∑ Testing camera access...");

          stream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment",
              width: { ideal: 640 },
              height: { ideal: 480 },
            },
          });

          video.srcObject = stream;
          video.style.display = "block";

          await new Promise((resolve) => {
            video.onloadedmetadata = () => {
              video.play();
              resolve();
            };
          });

          log("‚úÖ Camera started successfully!");
          log(`üìπ Video resolution: ${video.videoWidth}x${video.videoHeight}`);

          status.textContent = "‚úÖ Camera working! Now test object detection ‚Üí";
          status.style.background = "rgba(34, 197, 94, 0.2)";
        } catch (error) {
          log("‚ùå Camera error: " + error.message);
          status.textContent = "‚ùå Camera error: " + error.message;
          status.style.background = "rgba(239, 68, 68, 0.2)";
        }
      }

      async function testDetection() {
        try {
          if (!model) {
            throw new Error("Model not loaded! Run test 1 first.");
          }

          if (!stream) {
            throw new Error("Camera not started! Run test 2 first.");
          }

          status.textContent = "üîç Detecting objects...";
          log("üîç Running object detection...");

          const predictions = await model.detect(video);

          log(`üìä Raw predictions: ${predictions.length} objects found`);

          const filtered = predictions.filter((p) => p.score > 0.5);

          if (filtered.length > 0) {
            log(`‚úÖ Detected ${filtered.length} objects:`);
            filtered.forEach((pred) => {
              const conf = (pred.score * 100).toFixed(0);
              const [x, y, w, h] = pred.bbox.map((n) => Math.round(n));
              log(
                `  üîπ ${pred.class} (${conf}%) at [${x}, ${y}] size ${w}x${h}`
              );
            });

            status.textContent = `‚úÖ Found: ${filtered
              .map((p) => p.class)
              .join(", ")}`;
            status.style.background = "rgba(34, 197, 94, 0.2)";
          } else {
            log("‚ÑπÔ∏è No objects detected (try pointing camera at something)");
            status.textContent =
              "‚ÑπÔ∏è No objects detected - try pointing at people, chairs, phones, etc.";
            status.style.background = "rgba(251, 191, 36, 0.2)";
          }
        } catch (error) {
          log("‚ùå Detection error: " + error.message);
          status.textContent = "‚ùå Error: " + error.message;
          status.style.background = "rgba(239, 68, 68, 0.2)";
        }
      }

      log("üöÄ Test page loaded. Click buttons above to test each feature.");
      log("üìù Recommended order: 1 ‚Üí 2 ‚Üí 3");
    </script>
  </body>
</html>
